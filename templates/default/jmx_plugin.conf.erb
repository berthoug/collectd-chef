# This file autogenerated by Chef
# Do not edit, changes will be overwritten

LoadPlugin java

<Plugin java>
	JVMArg "-Djava.class.path=/usr/share/collectd/java/collectd-api.jar:/usr/share/collectd/java/generic-jmx.jar"

	LoadPlugin "org.collectd.java.GenericJMX"
	<Plugin "GenericJMX">

<% if node[:collectd][:clients].include?("nn") -%>
# NameNode ----------------------------------------------------------------------------
                <MBean "FSNamesystemState">
                        ObjectName "Hadoop:service=NameNode,name=FSNamesystemState"
                        InstancePrefix "FSNamesystemState"
                      <Value>
                                Type "gauge"
                                InstancePrefix "NumLiveDataNodes"
                                Table false
                                Attribute "NumLiveDataNodes"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "NumDeadDataNodes"
                                Table false
                                Attribute "NumDeadDataNodes"
                      </Value>
                </MBean>

                <MBean "FSNamesystem">
                        ObjectName "Hadoop:service=NameNode,name=FSNamesystem"
                        InstancePrefix "FSNamesystem"
                      <Value>
                                Type "counter"
                                InstancePrefix "ExpiredHeartbeats"
                                Table false
                                Attribute "ExpiredHeartbeats"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "MissingBlocks"
                                Table false
                                Attribute "MissingBlocks"
                      </Value>
                      <Value>
                                Type "memory"
                                InstancePrefix "CapacityTotalGB"
                                Table false
                                Attribute "CapacityTotalGB"
                      </Value>
                      <Value>
                                Type "memory"
                                InstancePrefix "CapacityUsedGB"
                                Table false
                                Attribute "CapacityUsedGB"
                      </Value>
                      <Value>
                                Type "memory"
                                InstancePrefix "CapacityRemainingGB"
                                Table false
                                Attribute "CapacityRemainingGB"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "TotalLoad"
                                Table false
                                Attribute "TotalLoad"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "BlocksTotal"
                                Table false
                                Attribute "BlocksTotal"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "FilesTotal"
                                Table false
                                Attribute "FilesTotal"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "PendingReplicationBlocks"
                                Table false
                                Attribute "PendingReplicationBlocks"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "UnderReplicatedBlocks"
                                Table false
                                Attribute "UnderReplicatedBlocks"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "CorruptBlocks"
                                Table false
                                Attribute "CorruptBlocks"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "ScheduledReplicationBlocks"
                                Table false
                                Attribute "ScheduledReplicationBlocks"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "PendingDeletionBlocks"
                                Table false
                                Attribute "PendingDeletionBlocks"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "ExcessBlocks"
                                Table false
                                Attribute "ExcessBlocks"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "BlockCapacity"
                                Table false
                                Attribute "BlockCapacity"
                      </Value>
                </MBean>

                <MBean "NameNodeActivity">
                        ObjectName "Hadoop:service=NameNode,name=NameNodeActivity"
                        InstancePrefix "NameNodeActivity"
                      <Value>
                                Type "counter"
                                InstancePrefix "CreateFileOps"
                                Table false
                                Attribute "CreateFileOps"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "FilesCreated"
                                Table false
                                Attribute "FilesCreated"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "FilesAppended"
                                Table false
                                Attribute "FilesAppended"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "GetBlockLocations"
                                Table false
                                Attribute "GetBlockLocations"
                      </Value>
	              <Value>
                                Type "counter"
                                InstancePrefix "FilesRenamed"
                                Table false
                                Attribute "FilesRenamed"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "GetListingOps"
                                Table false
                                Attribute "GetListingOps"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "DeleteFileOps"
                                Table false
                                Attribute "DeleteFileOps"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "FilesDeleted"
                                Table false
                                Attribute "FilesDeleted"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "FileInfoOps"
                                Table false
                                Attribute "FileInfoOps"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "AddBlockOps"
                                Table false
                                Attribute "AddBlockOps"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "GetAdditionalDatanodeOps"
                                Table false
                                Attribute "GetAdditionalDatanodeOps"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "CreateSymlinkOps"
                                Table false
                                Attribute "CreateSymlinkOps"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "GetLinkTargetOps"
                                Table false
                                Attribute "GetLinkTargetOps"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "FilesInGetListingOps"
                                Table false
                                Attribute "FilesInGetListingOps"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "TransactionsNumOps"
                                Table false
                                Attribute "TransactionsNumOps"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "TransactionsAvgTime"
                                Table false
                                Attribute "TransactionsAvgTime"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "SyncsNumOps"
                                Table false
                                Attribute "SyncsNumOps"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "SyncsAvgTime"
                                Table false
                                Attribute "SyncsAvgTime"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "TransactionsBatchedInSync"
                                Table false
                                Attribute "TransactionsBatchedInSync"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "BlockReportNumOps"
                                Table false
                                Attribute "BlockReportNumOps"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "BlockReportAvgTime"
                                Table false
                                Attribute "BlockReportAvgTime"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "SafeModeTime"
                                Table false
                                Attribute "SafeModeTime"
                      </Value>
                </MBean>

                <Connection>
                        #Service "HDFS"
                        #Role "NameNode"
                        ServiceURL "service:jmx:rmi:///jndi/rmi://<%= @dashboard_ip %>:<%= node[:hadoop][:nn][:jmxport] %>/jmxrmi"
                        Host "<%= @my_ip %>"
                        User "<%= node[:hadoop][:jmx][:username] %>"
                        Password "<%= node[:hadoop][:jmx][:password] %>"
                        Collect "FSNamesystem"
                        Collect "NameNodeActivity"
                        Collect "FSNamesystemState"
                </Connection>
<% end -%>


<% if node[:collectd][:clients].include?("dn") -%>
# DataNode ----------------------------------------------------------------------------
<!--

REST APIs:
Namenode - http://locahost:5070/jmx 
Datanode - http://locahost:5075/jmx 

                <MBean "DataNodeActivity">
                        ObjectName "Hadoop:service=DataNode,name=DataNodeActivity-<%= @my_ip %>-40101"
                        InstancePrefix "DataNodeActivity"

                      <Value>
                                Type "gauge"
                                InstancePrefix "BlockChecksumOpAvgTime"
                                Table false
                                Attribute "BlockChecksumOpAvgTime"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "BlockChecksumOpNumOps"
                                Table false
                                Attribute "BlockChecksumOpNumOps"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "BlockReportsAvgTime"
                                Table false
                                Attribute "BlockReportsAvgTime"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "BlockReportsNumOps"
                                Table false
                                Attribute "BlockReportsNumOps"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "BlockVerificationFailures"
                                Table false
                                Attribute "BlockVerificationFailures"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "BlocksRead"
                                Table false
                                Attribute "BlocksRead"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "BlocksRemoved"
                                Table false
                                Attribute "BlocksRemoved"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "BlocksReplicated"
                                Table false
                                Attribute "BlocksReplicated"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "BlocksVerified"
                                Table false
                                Attribute "BlocksVerified"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "BlocksWritten"
                                Table false
                                Attribute "BlocksWritten"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "BytesRead"
                                Table false
                                Attribute "BytesRead"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "BytesWritten"
                                Table false
                                Attribute "BytesWritten"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "CopyBlockOpAvgTime"
                                Table false
                                Attribute "CopyBlockOpAvgTime"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "CopyBlockOpNumOps"
                                Table false
                                Attribute "CopyBlockOpNumOps"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "HeartbeatsAvgTime"
                                Table false
                                Attribute "HeartbeatsAvgTime"
                      </Value>
                      <Value>
                                Type "counter"
                                InstancePrefix "HeartbeatsNumOps"
                                Table false
                                Attribute "HeartbeatsNumOps"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "ReadBlockOpAvgTime"
                                Table false
                                Attribute "ReadBlockOpAvgTime"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "ReadBlockOpNumOps"
                                Table false
                                Attribute "ReadBlockOpNumOps"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "ReadsFromLocalClient"
                                Table false
                                Attribute "ReadsFromLocalClient"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "ReadsFromRemoteClient"
                                Table false
                                Attribute "ReadsFromRemoteClient"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "ReplaceBlockOpAvgTime"
                                Table false
                                Attribute "ReplaceBlockOpAvgTime"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "ReplaceBlockOpNumOps"
                                Table false
                                Attribute "ReplaceBlockOpNumOps"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "VolumeFailures"
                                Table false
                                Attribute "VolumeFailures"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "WriteBlockOpAvgTime"
                                Table false
                                Attribute "WriteBlockOpAvgTime"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "WriteBlockOpNumOps"
                                Table false
                                Attribute "WriteBlockOpNumOps"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "WritesFromLocalClient"
                                Table false
                                Attribute "WritesFromLocalClient"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "WritesFromRemoteClient"
                                Table false
                                Attribute "WritesFromRemoteClient"
                      </Value>
                </MBean>

                <Connection>
                        #Service "HDFS"
                        #Role "DataNode"
                        ServiceURL "service:jmx:rmi:///jndi/rmi://<%= @dashboard_ip %>:<%= node[:hadoop][:dn][:jmxport] %>/jmxrmi"
                        Host "<%= @my_ip %>"
                        User "<%= node[:hadoop][:jmx][:username] %>"
                        Password "<%= node[:hadoop][:jmx][:password] %>"
                        Collect "DataNodeActivity"
                </Connection>
-->
<% end -%>

<% if node[:collectd][:clients].include?("rm") -%>
# ResourceManager ----------------------------------------------------------------------------
                <MBean "ResourceManager">
                        ObjectName "Hadoop:service=ResourceManager,name=QueueMetrics,q0=root"
                        InstancePrefix "ResourceManager"

                      <Value>
                                Type "gauge"
                                InstancePrefix "AppsSubmitted"
                                Table false
                                Attribute "AppsSubmitted"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "AppsRunning"
                                Table false
                                Attribute "AppsRunning"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "AppsPending"
                                Table false
                                Attribute "AppsPending"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "AppsCompleted"
                                Table false
                                Attribute "AppsCompleted"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "AppsKilled"
                                Table false
                                Attribute "AppsKilled"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "AppsFailed"
                                Table false
                                Attribute "AppsFailed"
                      </Value>


                      <Value>
                                Type "gauge"
                                InstancePrefix "AllocatedMB"
                                Table false
                                Attribute "AllocatedMB"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "AllocatedContainers"
                                Table false
                                Attribute "AllocatedContainers"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "AggregateContainersAllocated"
                                Table false
                                Attribute "AggregateContainersAllocated"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "AggregateContainersReleased"
                                Table false
                                Attribute "AggregateContainersReleased"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "AvailableMB"
                                Table false
                                Attribute "AvailableMB"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "PendingMB"
                                Table false
                                Attribute "PendingMB"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "PendingContainers"
                                Table false
                                Attribute "PendingContainers"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "ReservedMB"
                                Table false
                                Attribute "ReservedMB"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "ReservedContainers"
                                Table false
                                Attribute "ReservedContainers"
                      </Value>
                </MBean>

                <Connection>
                        #Service "YARN"
                        #Role "ResourceManager"
                        ServiceURL "service:jmx:rmi:///jndi/rmi://<%= @dashboard_ip %>:<%= node[:hadoop][:rm][:jmxport] %>/jmxrmi"
                        Host "<%=@my_ip %>"
                        User "<%= node[:hadoop][:jmx][:username] %>"
                        Password "<%= node[:hadoop][:jmx][:password] %>"
                        Collect "ResourceManager"
                </Connection>
<% end -%>


<% if node[:collectd][:clients].include?("nm") -%>
# NodeManager ----------------------------------------------------------------------------
                <MBean "NodeManager">
                        ObjectName "Hadoop:service=NodeManager,name=NodeManagerMetrics"
                        InstancePrefix "NodeManager"

                      <Value>
                                Type "gauge"
                                InstancePrefix "ContainersLaunched"
                                Table false
                                Attribute "ContainersLaunched"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "ContainersCompleted"
                                Table false
                                Attribute "ContainersCompleted"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "ContainersFailed"
                                Table false
                                Attribute "ContainersFailed"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "ContainersKilled"
                                Table false
                                Attribute "ContainersKilled"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "ContainersIniting"
                                Table false
                                Attribute "ContainersIniting"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "ContainersRunning"
                                Table false
                                Attribute "ContainersRunning"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "AllocatedGB"
                                Table false
                                Attribute "AllocatedGB"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "AllocatedContainers"
                                Table false
                                Attribute "AllocatedContainers"
                      </Value>
                      <Value>
                                Type "gauge"
                                InstancePrefix "AvailableGB"
                                Table false
                                Attribute "AvailableGB"
                      </Value>

                </MBean>

                <Connection>
                        #Service "YARN"
                        #Role "NodeManager"
                        ServiceURL "service:jmx:rmi:///jndi/rmi://<%= @dashboard_ip %>:<%= node[:hadoop][:nm][:jmxport] %>/jmxrmi"
                        Host "<%=@my_ip %>"
                        User "<%= node[:hadoop][:jmx][:username] %>"
                        Password "<%= node[:hadoop][:jmx][:password] %>"
                        Collect "NodeManager"
                </Connection>
<% end -%>

	</Plugin>
</Plugin>
